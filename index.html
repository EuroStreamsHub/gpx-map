<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <title>OSM Hiking Router (GraphHopper + Tracestack)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />  <!-- MapLibre GL JS -->  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>  <style>
    body { margin: 0; padding: 0; }
    #map { width: 100vw; height: 100vh; }
    .hint {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 8px 12px;
      font-family: sans-serif;
      font-size: 14px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }
  </style></head>
<body><div id="map"></div>
<div class="hint">Click to add points. Route snaps to OSM paths.</div><script>
  /**************** CONFIG ****************/

  // IMPORTANT: replace with your *restricted* GraphHopper API key
  const GRAPHOPPER_KEY = "60e48bae-2871-4d6c-9d2b-785d84fecc58";

  const ROUTE_PROFILE = "foot"; // foot | bike | car

  /****************************************/

  const map = new maplibregl.Map({
    container: 'map',
    style: {
      version: 8,
      sources: {
        tracestack: {
          type: 'raster',
          tiles: [
            `https://tiles.tracestack.com/topo/{z}/{x}/{y}.png?key=${TRACESTACK_KEY}`
          ],
          tileSize: 256,
          attribution: 'Â© OpenStreetMap contributors'
        }
      },
      layers: [
        {
          id: 'tracestack',
          type: 'raster',
          source: 'tracestack'
        }
      ]
    },
    center: [8.5417, 47.3769], // Zurich
    zoom: 13
  });

  let points = [];

  map.on('load', () => {
    map.addSource('route', {
      type: 'geojson',
      data: emptyFeature()
    });

    map.addLayer({
      id: 'route-line',
      type: 'line',
      source: 'route',
      paint: {
        'line-width': 4,
        'line-color': '#e11d48'
      }
    });

    map.addSource('markers', {
      type: 'geojson',
      data: emptyFeatureCollection()
    });

    map.addLayer({
      id: 'marker-points',
      type: 'circle',
      source: 'markers',
      paint: {
        'circle-radius': 6,
        'circle-color': '#2563eb',
        'circle-stroke-width': 2,
        'circle-stroke-color': '#ffffff'
      }
    });
  });

  map.on('click', async (e) => {
    points.push({ lat: e.lngLat.lat, lng: e.lngLat.lng });
    updateMarkers();

    if (points.length >= 2) {
      const geometry = await fetchRoute(points);
      if (geometry) updateRoute(geometry);
    }
  });

  async function fetchRoute(points) {
    const params = new URLSearchParams({
      profile: ROUTE_PROFILE,
      points_encoded: 'false',
      key: GRAPHOPPER_KEY
    });

    points.forEach(p => {
      params.append('point', `${p.lat},${p.lng}`);
    });

    const url = `https://graphhopper.com/api/1/route?${params.toString()}`;

    try {
      const res = await fetch(url);
      const json = await res.json();
      return json.paths[0].points;
    } catch (err) {
      console.error('Routing error:', err);
      return null;
    }
  }

  function updateRoute(geometry) {
    map.getSource('route').setData({
      type: 'Feature',
      geometry
    });
  }

  function updateMarkers() {
    map.getSource('markers').setData({
      type: 'FeatureCollection',
      features: points.map(p => ({
        type: 'Feature',
        geometry: {
          type: 'Point',
          coordinates: [p.lng, p.lat]
        }
      }))
    });
  }

  function emptyFeature() {
    return { type: 'Feature', geometry: { type: 'LineString', coordinates: [] } };
  }

  function emptyFeatureCollection() {
    return { type: 'FeatureCollection', features: [] };
  }
</script></body>
</html>
